<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>세그먼트 탭 (슬라이드 인디케이터) — 동작하는 예제</title>
<style>
  :root{
    --color-bg: #f3f6fa;
    --color-active-border: #0066ff;
    --color-inactive: #333;
    --indicator-bg: #fff;
  }
  body{ font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Helvetica Neue", Arial; padding:40px; background:#fff; }

  .tabs-container{
    display:inline-block;
    background:var(--color-bg);
    border-radius:999px;
    padding:4px;
    position:relative;
  }
  .tabs{ display:flex; position:relative; }
  .tab-indicator{
    position:absolute;
    top:4px;
    bottom:4px;
    left:0;
    background:var(--indicator-bg);
    border-radius:999px;
    border:1px solid var(--color-active-border);
    transition:left .28s cubic-bezier(.22,.9,.36,1), width .28s cubic-bezier(.22,.9,.36,1);
    z-index:0;
  }

  .tab{
    position:relative;
    z-index:1;
    background:none;
    border:none;
    border-radius:999px;
    padding:6px 16px;
    font-size:14px;
    cursor:pointer;
    color:var(--color-inactive);
    display:flex;
    align-items:center;
    gap:8px;
  }
  .tab[aria-selected="true"]{ color:var(--color-active-border); font-weight:600; }
  .tab:focus-visible{ outline:2px solid rgba(0,102,255,.15); outline-offset:3px; }

  /* 임시 아이콘 스타일 (실제프로젝트에선 svg 권장) */
  .icon{ width:14px; height:14px; background:currentColor; border-radius:2px; display:inline-block; }
</style>
</head>
<body>

<div class="tabs-container">
  <div class="tabs" role="tablist" aria-label="세그먼트 탭 예시">
    <span class="tab-indicator" aria-hidden="true"></span>

    <button class="tab" role="tab" aria-selected="true" data-value="a">
      <span class="icon" aria-hidden="true"></span>
      <span>텍스트</span>
    </button>

    <button class="tab" role="tab" aria-selected="false" data-value="b">
      <span>텍스트</span>
    </button>

    <button class="tab" role="tab" aria-selected="false" data-value="c">
      <span>텍스트</span>
    </button>
  </div>
</div>

<script>
  const tab = window.tab || {};

  /**
   * segmentTab: 범용 세그먼트 탭 초기화 (여러 개 인스턴스 지원)
   * @param {string} containerSelector - 탭 컨테이너 셀렉터 (예: ".tabs-container")
   */
  tab.segmentTab = function(containerSelector){
    const containers = document.querySelectorAll(containerSelector);
    if (!containers.length) {
      // 선택자 불일치로 동작하지 않을 때 개발 편의를 위해 콘솔에 경고
      console.warn('tab.segmentTab: container not found for selector:', containerSelector);
      return;
    }

    containers.forEach(container => {
      const tabs = Array.from(container.querySelectorAll('.tab'));
      const indicator = container.querySelector('.tab-indicator');
      if (!tabs.length || !indicator) return;

      // aria-selected 관리와 tabindex 설정
      function setInitialTabState(){
        let active = container.querySelector('.tab[aria-selected="true"]');
        if (!active) {
          active = tabs[0];
          active.setAttribute('aria-selected','true');
        }
        tabs.forEach(t => {
          t.setAttribute('tabindex', t === active ? '0' : '-1');
        });
        moveIndicator(active);
      }

      // 인디케이터 이동
      function moveIndicator(tabEl){
        if (!tabEl) return;
        const rect = tabEl.getBoundingClientRect();
        const parentRect = container.getBoundingClientRect();
        const left = rect.left - parentRect.left;
        indicator.style.left = left + 'px';
        indicator.style.width = rect.width + 'px';
      }

      // 탭 활성화 (aria-selected, tabindex, 커스텀 이벤트)
      function activateTab(tabEl){
        tabs.forEach(t => {
          t.setAttribute('aria-selected','false');
          t.setAttribute('tabindex','-1');
        });
        tabEl.setAttribute('aria-selected','true');
        tabEl.setAttribute('tabindex','0');
        moveIndicator(tabEl);

        // 커스텀 이벤트(필요하면 리스너에서 value를 받아 처리 가능)
        const value = tabEl.dataset.value ?? null;
        container.dispatchEvent(new CustomEvent('segmentTabChange', {
          detail: { value, tab: tabEl }
        }));
      }

      // 클릭 이벤트 바인딩
      tabs.forEach(t => {
        t.addEventListener('click', () => {
          activateTab(t);
          t.focus();
        });

        // 키보드 접근성: 좌우, Home, End
        t.addEventListener('keydown', (e) => {
          const idx = tabs.indexOf(t);
          let targetIndex = null;
          if (e.key === 'ArrowRight' || e.key === 'Right') targetIndex = (idx + 1) % tabs.length;
          if (e.key === 'ArrowLeft' || e.key === 'Left') targetIndex = (idx - 1 + tabs.length) % tabs.length;
          if (e.key === 'Home') targetIndex = 0;
          if (e.key === 'End') targetIndex = tabs.length - 1;

          if (targetIndex !== null) {
            e.preventDefault();
            const target = tabs[targetIndex];
            activateTab(target);
            target.focus();
          }
        });
      });

      // 리사이즈 대응 (디바운스)
      let resizeTimer = null;
      window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          const active = container.querySelector('.tab[aria-selected="true"]') || tabs[0];
          moveIndicator(active);
        }, 80);
      });

      // 초기화
      setInitialTabState();
    });
  };

  // DOM 준비되면 초기화 (컨테이너 클래스가 .tabs-container 인 경우)
  document.addEventListener('DOMContentLoaded', () => {
    tab.segmentTab('.tabs-container'); // <-- 여기 셀렉터가 HTML 클래스와 일치해야 함
  });

  // (선택) 탭 변경 이벤트 예시 리스너
  document.querySelectorAll('.tabs-container').forEach(c => {
    c.addEventListener('segmentTabChange', (e) => {
      // console.log('탭 변경:', e.detail.value, e.detail.tab);
    });
  });
</script>
</body>
</html>
